const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ChatView-C1Z61jci.js","./router-B4-DsX-D.js","./vue-core-Bj9NSyid.js","./highlight-C7QV_n3L.js","../css/highlight-C8LL_u4z.css","./i18n-Cs-aH8_I.js","./vendor-CJNHjaSW.js","./marked-txETn4SA.js","./state-B_8nituZ.js","./mock-CWrnY2TL.js","../css/ChatView-BCMf6O_O.css","./SettingsView-Dsq0JfMh.js","../css/SettingsView-Cua7Dan0.css","./RegisterView-Dy0YP5hK.js","../css/RegisterView-BPX7w-Bn.css","./LoginView-DonUAo7e.js","../css/LoginView-C5uTTqdL.css"])))=>i.map(i=>d[i]);
import{r as e,o as t,z as a,A as s,B as n,f as o,C as i,u as l,D as r,E as d,G as c,H as u,p as g,c as m,I as p,J as h,K as _,L as y,M as w,N as f,F as S,O as v,P as k,Q as I,R as b,S as C,n as E,U as D}from"./vue-core-Bj9NSyid.js";import{d as T,c as P,s as A}from"./state-B_8nituZ.js";import{R as M,u as B,a as R,c as O,b as x}from"./router-B4-DsX-D.js";import{u as N,c as $}from"./i18n-Cs-aH8_I.js";import{W as L}from"./vendor-CJNHjaSW.js";import{M as F}from"./mock-CWrnY2TL.js";import"./highlight-C7QV_n3L.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const H={key:0,class:"app-loading"},j={class:"app-loading-text"},U={key:1,class:"app-container"},G={__name:"App",setup(m){const{t:p}=N(),h=e(!1),_=e("1.0.0");return g("appVersion",_),t((async()=>{localStorage.getItem("access_token"),localStorage.getItem("refresh_token"),localStorage.getItem("token_type"),setTimeout((()=>{h.value=!0}),300)})),(e,t)=>h.value?(r(),a("div",U,[o(l(M),null,{default:i((({Component:e})=>[o(d,{name:"fade",mode:"out-in"},{default:i((()=>[(r(),c(u(e)))])),_:2},1024)])),_:1})])):(r(),a("div",H,[t[0]||(t[0]=s("div",{class:"app-loading-spinner"},null,-1)),s("div",j,n(p("main.loading")),1)]))}},K={},Y=function(e,t,a){let s=Promise.resolve();if(t&&t.length>0){const e=document.getElementsByTagName("link"),n=document.querySelector("meta[property=csp-nonce]"),o=(null==n?void 0:n.nonce)||(null==n?void 0:n.getAttribute("nonce"));s=Promise.allSettled(t.map((t=>{if(t=function(e,t){return new URL(e,t).href}(t,a),t in K)return;K[t]=!0;const s=t.endsWith(".css"),n=s?'[rel="stylesheet"]':"";if(a)for(let a=e.length-1;a>=0;a--){const n=e[a];if(n.href===t&&(!s||"stylesheet"===n.rel))return}else if(document.querySelector(`link[href="${t}"]${n}`))return;const i=document.createElement("link");return i.rel=s?"stylesheet":"modulepreload",s||(i.as="script"),i.crossOrigin="",i.href=t,o&&i.setAttribute("nonce",o),document.head.appendChild(i),s?new Promise(((e,a)=>{i.addEventListener("load",e),i.addEventListener("error",(()=>a(new Error(`Unable to preload CSS for ${t}`))))})):void 0})))}function n(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return s.then((t=>{for(const e of t||[])"rejected"===e.status&&n(e.reason);return e().catch(n)}))},V=T("chat",{state:()=>({messages:[],chatHistory:[],currentChatId:null}),actions:{addMessage(e){const t={id:e.id||L(),timestamp:e.timestamp||(new Date).toISOString(),...e};return this.messages.push(t),this.currentChatId&&this.syncMessagesToHistory(),t},updateMessage(e,t){if(e>=0&&e<this.messages.length){const a=this.messages[e].id;this.messages[e]={...t,id:a,timestamp:(new Date).toISOString(),edited:!0},this.updateMessageInHistory(a,this.messages[e]),this.currentChatId&&this.syncMessagesToHistory()}},updateMessageInHistory(e,t){this.chatHistory.forEach((a=>{if(a&&a.messages&&Array.isArray(a.messages)){const s=a.messages.findIndex((t=>t.id===e));-1!==s&&(a.messages[s]=t)}}))},detectMessageType:e=>e.startsWith("http")&&/\.(png|jpg|jpeg|gif|webp)$/i.test(e)?{type:"image",content:e}:/^\s*(const|let|var|function|class|import|export)\s+/.test(e)||e.includes(";")?{type:"code",content:e,language:"javascript"}:{type:"text",content:e},deleteChat(e){const t=this.chatHistory.findIndex((t=>t.id==e));-1!==t&&(this.chatHistory.splice(t,1),this.currentChatId===e&&(this.messages=[],this.currentChatId=null))},updateChatTitle(e,t){const a=this.chatHistory.find((t=>t.id==e));a&&(a.title=t,a.timestamp=(new Date).toISOString())},createNewChat(e="新的對話"){const t=Date.now(),a={id:t,title:e,timestamp:(new Date).toISOString(),messages:[]};return this.chatHistory.unshift(a),this.messages=[],this.currentChatId=t,t},loadChat(e){const t=this.chatHistory.find((t=>t.id===e));t?t.messages&&Array.isArray(t.messages)?this.messages=[...t.messages]:(this.messages=[],t.messages=[]):this.messages=[],this.currentChatId=e},syncMessagesToHistory(){if(!this.currentChatId)return;const e=this.chatHistory.find((e=>e.id===this.currentChatId));e&&(e.messages||(e.messages=[]),e.messages=JSON.parse(JSON.stringify(this.messages)),e.timestamp=(new Date).toISOString())},clearCurrentChat(){this.messages=[],this.currentChatId=null}},persist:!0}),W=(e,t)=>{const a=e.__vccOpts||e;for(const[s,n]of t)a[s]=n;return a},q=["width","height","viewBox","stroke","stroke-width"],z={key:0},J=W(Object.assign({name:"IconBase"},{__name:"IconBase",props:{width:{type:[Number,String],default:20},height:{type:[Number,String],default:20},color:{type:String,default:"currentColor"},title:{type:String,default:null},viewBox:{type:String,default:"0 0 24 24"},strokeWidth:{type:[Number,String],default:2}},setup(e){const t=e,s=m((()=>({width:"number"==typeof t.width?`${t.width}px`:t.width,height:"number"==typeof t.height?`${t.height}px`:t.height})));return(t,o)=>(r(),a("svg",{xmlns:"http://www.w3.org/2000/svg",width:e.width,height:e.height,viewBox:e.viewBox,style:_(s.value),fill:"none",stroke:e.color,"stroke-width":e.strokeWidth,"stroke-linecap":"round","stroke-linejoin":"round","aria-hidden":"true",role:"img"},[e.title?(r(),a("title",z,n(e.title),1)):p("",!0),h(t.$slots,"default",{},void 0)],12,q))}}),[["__scopeId","data-v-07f3b491"]]),X=Object.assign({name:"PlusIcon"},{__name:"PlusIcon",setup:e=>(e,t)=>(r(),c(J,y(w(e.$attrs)),{default:i((()=>t[0]||(t[0]=[s("line",{x1:"12",y1:"5",x2:"12",y2:"19"},null,-1),s("line",{x1:"5",y1:"12",x2:"19",y2:"12"},null,-1)]))),_:1},16))}),Q=Object.assign({name:"ChatIcon"},{__name:"ChatIcon",setup:e=>(e,t)=>(r(),c(J,y(w(e.$attrs)),{default:i((()=>t[0]||(t[0]=[s("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"},null,-1)]))),_:1},16))}),Z={key:0,d:"M10 7l5 5-5 5","stroke-linecap":"round","stroke-linejoin":"round"},ee={key:1,d:"M14 7l-5 5 5 5","stroke-linecap":"round","stroke-linejoin":"round"},te={key:2,d:"M7 14l5-5 5 5","stroke-linecap":"round","stroke-linejoin":"round"},ae={key:3,d:"M7 10l5 5 5-5","stroke-linecap":"round","stroke-linejoin":"round"},se=W(Object.assign({name:"ChevronIcon"},{__name:"ChevronIcon",props:{direction:{type:String,default:"right",validator:e=>["left","right","up","down"].includes(e)}},setup:e=>(t,s)=>(r(),c(J,f(t.$attrs,{"stroke-width":3,color:"#999"}),{default:i((()=>["right"===e.direction?(r(),a("path",Z)):"left"===e.direction?(r(),a("path",ee)):"up"===e.direction?(r(),a("path",te)):"down"===e.direction?(r(),a("path",ae)):p("",!0)])),_:1},16))}),[["__scopeId","data-v-6842beea"]]),ne=Object.assign({name:"EditIcon"},{__name:"EditIcon",setup:e=>(e,t)=>(r(),c(J,y(w(e.$attrs)),{default:i((()=>t[0]||(t[0]=[s("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"},null,-1),s("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"},null,-1)]))),_:1},16))}),oe=Object.assign({name:"TrashIcon"},{__name:"TrashIcon",setup:e=>(e,t)=>(r(),c(J,y(w(e.$attrs)),{default:i((()=>t[0]||(t[0]=[s("polyline",{points:"3 6 5 6 21 6"},null,-1),s("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"},null,-1)]))),_:1},16))}),ie="http://118.163.62.178:8087/api/v1",le={SESSIONS:`${ie}/chat_sessions`,SESSION_BY_ID:e=>`${ie}/chat_sessions/${e}`,MESSAGES:e=>`${ie}/chat_sessions/${e}/messages`,MESSAGE_BY_ID:(e,t)=>`${ie}/chat_sessions/${e}/messages/${t}`,CHAT_RAG_COMPLETION:e=>`${ie}/chat_sessions/${e}/chat_rag`},re={BASE:`${ie}/knowledge_bases`,BY_ID:e=>`${ie}/knowledge_bases/${e}`,DOCUMENTS:e=>`${ie}/knowledge_bases/${e}/source_documents`,DOCUMENT_BY_ID:(e,t)=>`${ie}/knowledge_bases/${e}/source_documents/${t}`,UPLOAD:e=>`${ie}/knowledge_bases/${e}/source_documents_stream`,UPLOAD_STATUS:(e,t)=>`${ie}/knowledge_bases/${e}/source_documents_stream/${t}`},de={MODELS:`${ie}/llms`},ce={LOGIN:`${ie}/auth/login`,REGISTER:`${ie}/auth/register`},ue=async(e,t="GET",a=null)=>{try{const s=localStorage.getItem("access_token"),n=await fetch(`${e}`,{method:t,headers:{Accept:"application/json",Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:a?JSON.stringify(a):void 0});if(!n.ok){const e=await n.json(),{detail:t,msg:a}=e;if(Array.isArray(t)&&t.length>0){const[{msg:e}]=t;throw new Error(e||"Unexpected error")}throw new Error(t||a||"Unexpected error")}return await n.json()}catch(s){throw s}},ge={getChatSessions:async()=>ue(le.SESSIONS,"GET"),getChatSessionsByID:async e=>ue(le.SESSION_BY_ID(e),"GET"),postChatSessions:async e=>ue(le.SESSIONS,"POST",e),patchChatSessionsByID:async(e,t)=>ue(le.SESSION_BY_ID(e),"PATCH",t),deleteChatSessionsByID:async e=>ue(le.SESSION_BY_ID(e),"DELETE"),getMessagesBySessionID:async e=>ue(le.MESSAGES(e),"GET"),postMessagesBySessionID:async(e,t)=>ue(le.MESSAGES(e),"POST",t),patchMessagesByID:async(e,t,a)=>ue(le.MESSAGE_BY_ID(e,t),"PATCH",a),getChatCompletionStream:async(e,t,a)=>{try{const s=localStorage.getItem("access_token"),n=await fetch(le.CHAT_RAG_COMPLETION(e),{method:"POST",headers:{Accept:"text/event-stream",Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({message:t,llm_id:a})});if(!n.ok){const e=await n.json(),{detail:t,msg:a}=e;if(Array.isArray(t)&&t.length>0){const[{msg:e}]=t;throw new Error(e||"Unexpected error")}throw new Error(t||a||"Unexpected error")}if(!n.body)throw new Error("Stream not supported by the server.");return n.body}catch(s){throw s}}},me={login:async(e,t)=>ue(ce.LOGIN,"POST",{email:e,password:t}),register:async e=>ue(ce.REGISTER,"POST",e),getUserInfo:async()=>ue(ce.PROFILE),updateUserInfo:async e=>ue(ce.UPDATE_PROFILE,"PUT",e)},pe={getStatus:async()=>ue(de.STATUS),getConfig:async()=>ue(de.SETTINGS),updateConfig:async e=>ue(de.SETTINGS,"PUT",e),getAvailableModels:async()=>ue(de.MODELS),getLLM:async()=>ue(de.MODELS,"GET")},he={getKnowledgeBases:async()=>await ue(re.BASE,"GET"),getKnowledgeByID:async e=>await ue(re.BY_ID(e),"GET"),postKnowledge:async e=>await ue(re.BASE,"POST",e),patchKnowledgeByID:async(e,t)=>await ue(re.BY_ID(e),"PATCH",t),getKnowledgeBasesDocs:async e=>await ue(re.DOCUMENTS(e),"GET"),getFileCompletionStream:async(e,t)=>{try{const a=localStorage.getItem("access_token"),s=new FormData;t.forEach((e=>s.append("files",e)));const n=await fetch(re.UPLOAD(e),{method:"POST",headers:{Authorization:`Bearer ${a}`,Accept:"text/event-stream"},body:s});if(200!==n.status){const e=await n.json(),{detail:t,msg:a}=e;if(Array.isArray(t)&&t.length>0){const[{msg:e}]=t;throw new Error(e||"Unexpected error")}throw new Error(t||a||"Unexpected error")}if(!n.body)throw new Error("Stream not supported by the server.");return n.body}catch(a){throw a}}};let _e=!0;const ye=e=>(_e=e,localStorage.setItem("useMockData",e),_e),we=()=>{const e=localStorage.getItem("useMockData");return null!==e&&(_e="true"===e),_e},fe={class:"sider-head"},Se=["title"],ve=["title"],ke={key:0},Ie={key:0,class:"sider-history"},be={key:0,class:"sider-history__category-title"},Ce=["onClick"],Ee={class:"sider-history__item-content"},De={key:0,class:"sider-history__details"},Te={class:"sider-history__title"},Pe={class:"sider-history__date"},Ae={key:0,class:"sider-history__actions"},Me=["onClick"],Be=["onClick"],Re={key:1,class:"sider-empty"},Oe={class:"sider-empty__text"},xe={key:3,class:"delete-confirm"},Ne={class:"delete-confirm__content"},$e={class:"delete-confirm__actions"},Le=W(Object.assign({name:"左側欄位"},{__name:"SiderBar",setup(i,{expose:d}){const{t:c}=N(),u=V(),g=B(),h=R(),_=e(!1),y=e(!1),w=e(!1),f=e(null),b=e=>c(`main.${e}`),C=()=>{y.value=window.innerWidth<768,y.value&&(_.value=!0)};t((async()=>{if(C(),window.addEventListener("resize",C),"mock"!==we())try{const e=localStorage.getItem("access_token"),t=localStorage.getItem("refresh_token"),a=localStorage.getItem("token_type");if(e&&t&&a){const e=await ge.getChatSessions();Array.isArray(e)&&(u.chatHistory=[],e.forEach((e=>{u.chatHistory.push({id:e.id,title:e.title||"未命名對話",description:e.description,user_id:e.user_id,is_top:e.is_top||!1,attached_messages_count:e.attached_messages_count||0,knowledge_base_id:e.knowledge_base_id,instructionId:e.instructionId,model:e.model,llm_id:e.llm_id,llm_display_name:e.llm_display_name,created_at:e.created_at,updated_at:e.updated_at})})))}}catch(e){}}));const E=()=>{_.value=!_.value};d({toggleSider:E});const D=async()=>{g.push("/")},T=async()=>{if(f.value)try{if("mock"!==we()){await ge.deleteChatSessionsByID(f.value);const e=await ge.getChatSessions();Array.isArray(e)&&(u.chatHistory=[],e.forEach((e=>{u.chatHistory.push({id:e.id,title:e.title||"未命名對話",description:e.description,user_id:e.user_id,is_top:e.is_top||!1,attached_messages_count:e.attached_messages_count||0,knowledge_base_id:e.knowledge_base_id,instructionId:e.instructionId,model:e.model,llm_id:e.llm_id,llm_display_name:e.llm_display_name,created_at:e.created_at,updated_at:e.updated_at})}))),g.push("/")}else u.deleteChat(f.value),h.params.id==f.value&&(u.chatHistory.length>0?g.push(`/chat/${u.chatHistory[0].id}`):g.push("/"));w.value=!1,f.value=null}catch(e){alert("刪除對話失敗，請稍後再試"),w.value=!1,f.value=null}},P=()=>{w.value=!1,f.value=null},A=m((()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate()),a=new Date(t);a.setDate(a.getDate()-1);const s=new Date(t);s.setDate(s.getDate()-7);const n=new Date(t);n.setDate(n.getDate()-30);const o=e.getFullYear(),i={today:{label:b("today"),chats:[]},yesterday:{label:b("yesterday"),chats:[]},last7Days:{label:b("last7Days"),chats:[]},last30Days:{label:b("last30Days"),chats:[]},february:{label:"2 月",chats:[]},january:{label:"1 月",chats:[]},thisYear:{label:`${o} 年`,chats:[]},lastYear:{label:o-1+" 年",chats:[]}};return u.chatHistory.forEach((e=>{if(!e.updated_at)return;const l=new Date(1e3*e.updated_at),r=l.getFullYear(),d=l.getMonth();l>=t?i.today.chats.push(e):l>=a?i.yesterday.chats.push(e):l>=s?i.last7Days.chats.push(e):l>=n?i.last30Days.chats.push(e):r===o&&1===d?i.february.chats.push(e):r===o&&0===d?i.january.chats.push(e):r===o?i.thisYear.chats.push(e):r===o-1&&i.lastYear.chats.push(e)})),Object.values(i).forEach((e=>{e.chats.sort(((e,t)=>(t.updated_at||0)-(e.updated_at||0)))})),Object.values(i).filter((e=>e.chats.length>0))})),M=(e,t=20)=>e?e.length<=t?e:e.substring(0,t)+"...":"未命名對話",O=()=>{g.push("/"),y.value&&(_.value=!0)};return(e,t)=>(I("router-link"),r(),a("div",{class:k(["sider",{"sider--collapsed":_.value}])},[s("div",fe,[_.value?(r(),a("div",{key:1,class:"sider-head__logo sider-head__logo--small",onClick:O,style:{cursor:"pointer"}},"AI ")):(r(),a("div",{key:0,class:"sider-head__logo",onClick:O,style:{cursor:"pointer"}},"AI 助手")),s("div",{class:"sider-head__toggle",onClick:E,title:_.value?"展開側邊欄":"收起側邊欄"},[o(l(se),{direction:_.value?"right":"left"},null,8,["direction"])],8,Se)]),s("div",{class:"sider-btn__new-chat",onClick:D,title:_.value?b("newChat"):""},[o(l(X)),_.value?p("",!0):(r(),a("span",ke,n(b("newChat")),1))],8,ve),l(u).chatHistory.length>0?(r(),a("div",Ie,[(r(!0),a(S,null,v(A.value,((e,t)=>(r(),a("div",{key:t,class:"sider-history__category"},[_.value?p("",!0):(r(),a("div",be,n(e.label),1)),(r(!0),a(S,null,v(e.chats,(e=>{return r(),a("div",{key:e.id,class:k(["sider-history__item",{"sider-history__item--active":(i=e.id,h.params.id==i)}]),onClick:t=>(async e=>{try{if(we())u.loadChat(e);else{const t=await ge.getChatSessionsByID(e),a=await ge.getMessagesBySessionID(e);t.knowledge_base_id&&await he.getKnowledgeByID(t.knowledge_base_id),u.messages=a||[],u.currentChatId=e;const s=u.chatHistory.findIndex((t=>t.id===e));-1!==s&&(u.chatHistory[s].messages=a||[])}g.push(`/chat/${e}`),y.value&&(_.value=!0)}catch(t){}})(e.id)},[s("div",Ee,[_.value?p("",!0):(r(),a("div",De,[s("div",Te,n(M(e.title)),1),s("div",Pe,n((t=e.created_at,t?new Date(1e3*t).toLocaleDateString():"")),1)]))]),_.value?p("",!0):(r(),a("div",Ae,[s("button",{class:"sider-history__action-btn",onClick:t=>(async(e,t)=>{e.stopPropagation();const a=prompt("請輸入新的對話標題",t.title);if(a&&""!==a.trim()&&a.trim()!==t.title)try{if("mock"!==we()){await ge.patchChatSessionsByID(t.id,{title:a.trim()});const e=await ge.getChatSessions();Array.isArray(e)&&(u.chatHistory=[],e.forEach((e=>{u.chatHistory.push({id:e.id,title:e.title||"未命名對話",description:e.description,user_id:e.user_id,is_top:e.is_top||!1,attached_messages_count:e.attached_messages_count||0,knowledge_base_id:e.knowledge_base_id,instructionId:e.instructionId,model:e.model,llm_id:e.llm_id,llm_display_name:e.llm_display_name,created_at:e.created_at,updated_at:e.updated_at})})))}else u.updateChatTitle(t.id,a.trim())}catch(s){alert("更新標題失敗，請稍後再試")}})(t,e),title:"重命名"},[o(l(ne),{width:"14",height:"14"})],8,Me),s("button",{class:"sider-history__action-btn",onClick:t=>((e,t)=>{e.stopPropagation(),f.value=t,w.value=!0})(t,e.id),title:"刪除"},[o(l(oe),{width:"14",height:"14"})],8,Be)]))],10,Ce);var t,i})),128))])))),128))])):(r(),a("div",Re,[o(l(Q),{class:"sider-empty__icon",width:"48",height:"48"}),s("div",Oe,n(b("noChats")),1)])),p("",!0),w.value?(r(),a("div",xe,[s("div",Ne,[s("h3",null,n(b("confirmDelete")),1),s("p",null,n(b("confirmDeleteSubtext")),1),s("div",$e,[s("button",{class:"delete-confirm__cancel",onClick:P},n(b("cancel")),1),s("button",{class:"delete-confirm__delete",onClick:T},n(b("delete")),1)])])])):p("",!0)],2))}}),[["__scopeId","data-v-a2ca23c7"]]),Fe={width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"stroke-[2] relative"},He={__name:"SendIcon",props:{width:{type:[Number,String],default:36},height:{type:[Number,String],default:36}},setup:e=>(e,t)=>(r(),a("svg",Fe,t[0]||(t[0]=[s("path",{d:"M5 11L12 4M12 4L19 11M12 4V21",stroke:"currentColor"},null,-1)])))},je={class:"message-input"},Ue={key:0,class:"message-input__error"},Ge=["placeholder"],Ke={class:"message-input__textarea-div"},Ye=["disabled","title"],Ve={key:0},We={key:1,class:"loading-spinner"},qe=W(Object.assign({name:"使用者輸入框"},{__name:"MessageInput",props:{isLoading:{type:Boolean,default:!1}},emits:["message-submit","processing-state-change"],setup(t,{emit:i}){const l=t,d=i,{t:c}=N(),u=e=>c(`main.${e}`),g=V(),h=R(),_=B(),y=e(""),w=e(null),f=e(""),S=m((()=>{const e=localStorage.getItem("access_token"),t=localStorage.getItem("refresh_token"),a=localStorage.getItem("token_type");return!!(e&&t&&a)})),v=(e,t=" \n\n")=>{const a=[],s=e.split(t);for(const o of s)try{if(!o.trim())continue;const e=JSON.parse(o);a.push(e)}catch(n){a.push(null)}return a.filter((e=>!!e))},I=async()=>{if(y.value.trim()&&!l.isLoading){if(f.value="",!S.value)return alert(c("auth.notAuthenticated")),void _.push("/login");var e;d("processing-state-change",!0);try{let s=h.params.id;s||(s=await(async()=>{try{const e=await ge.postChatSessions({title:u("newChat")});if(!e||!e.id)throw new Error(u("newChatFailed"));g.currentChatId=e.id,await ge.patchChatSessionsByID(e.id,{title:`${u("newChat")} ${e.id}`});const t=await ge.getChatSessions(),a=await he.postKnowledge({name:`${u("knowledgeBase")} ${(new Date).toLocaleDateString("zh-TW").replace(/\//g,"")}`,description:u("defaultDescription")});return await ge.getMessagesBySessionID(e.id),await ge.patchChatSessionsByID(e.id,{knowledge_base_id:a.id}),Array.isArray(t)&&(g.chatHistory=[],t.forEach((e=>{g.chatHistory.push({id:e.id,title:e.title||u("defaultTitle"),description:e.description,user_id:e.user_id,is_top:e.is_top||!1,attached_messages_count:e.attached_messages_count||0,knowledge_base_id:e.knowledge_base_id,instructionId:e.instructionId,model:e.model,llm_id:e.llm_id,llm_display_name:e.llm_display_name,created_at:e.created_at,updated_at:e.updated_at})}))),await _.push(`/chat/${e.id}`),e.id}catch(e){throw e}})());const n=(e=y.value).startsWith("http")&&/\.(png|jpg|jpeg|gif|webp)$/i.test(e)?{type:"image",message:e}:e.includes("列表")||e.includes("步驟")||e.includes("清單")||e.includes("排名")||e.includes("優點")||e.includes("缺點")||e.includes("比較")?{type:"list",message:e}:e.includes("表格")||e.includes("比較表")||e.includes("數據表")||e.includes("價格表")?{type:"table",message:e}:/^\s*(const|let|var|function|class|import|export)\s+/.test(e)||e.includes(";")||e.includes("{")&&e.includes("}")?{type:"code",message:e,language:"javascript"}:e.includes("def ")||e.includes("import ")||e.includes("class ")||e.includes("print(")||e.includes("if __name__ == '__main__'")?{type:"code",message:e,language:"python"}:e.includes("public class")||e.includes("private")||e.includes("protected")||e.includes("System.out.println")?{type:"code",message:e,language:"java"}:e.includes("SELECT ")||e.includes("INSERT INTO ")||e.includes("UPDATE ")||e.includes("DELETE FROM ")||e.includes("CREATE TABLE")?{type:"code",message:e,language:"sql"}:e.includes("<html")||e.includes("<!DOCTYPE")||e.includes("<")&&e.includes(">")&&(e.includes("<div")||e.includes("<p")||e.includes("<body"))?{type:"code",message:e,language:"html"}:e.includes("{")&&e.includes("}")&&(e.includes("margin:")||e.includes("padding:")||e.includes("color:")||e.includes("font-size:"))?{type:"code",message:e,language:"css"}:e.includes("<template>")||e.includes("<script>")&&e.includes("export default")?{type:"code",message:e,language:"vue"}:{type:"text",message:e},o=y.value;y.value="",(async()=>{await E(),w.value&&(w.value.style.height="auto",w.value.style.height=`${w.value.scrollHeight}px`)})();const i=localStorage.getItem("selected_llm_id")||1,l=await ge.postMessagesBySessionID(s,{message:o,role:"user",llm_id:i,session_id:s,canceled:!1,failed:!1,startTime:Math.floor(Date.now()/1e3)});g.addMessage({...n,role:"user",id:l.id,session_id:s,chat_id:s}),d("message-submit",{...n,id:l.id,session_id:s,chat_id:s,role:"user",message:o});const r=(await ge.postMessagesBySessionID(s,{message:"",role:"assistant",llm_id:i,session_id:s,canceled:!1,failed:!1,startTime:Math.floor(Date.now()/1e3)})).id;g.addMessage({type:n.type,content:"",role:"assistant",language:n.language||null,id:r,session_id:s,chat_id:s,message:""});try{const e=await ge.getChatCompletionStream(s,o,i);if(e){if(e.locked)throw new Error("Stream is locked. Please try again.");const n=e.getReader(),o=new TextDecoder("utf-8");let i="",l="",d=Date.now();try{for(;;){const{done:e,value:t}=await n.read();if(e)break;const a=i+o.decode(t,{stream:!0});i=a.split(" \n\n").pop()||"";const s=v(a);for(const n of s){if(n&&"message"in n){const{message:e}=n;l+=e.content;const t=g.messages.findIndex((e=>e.id===r));-1!==t&&g.updateMessage(t,{...g.messages[t],content:l,message:l})}Date.now()-d>1e3&&(d=Date.now())}}}catch(t){f.value="Error during stream processing"}finally{try{await n.cancel("Stream handling finished."),await e.cancel()}catch(a){}finally{n.releaseLock()}await ge.patchMessagesByID(s,r,{message:l})}}}catch(t){f.value=t.message||u("unknowError");const e=g.messages.findIndex((e=>e.id===r));-1!==e&&g.updateMessage(e,{...g.messages[e],failed:!0,content:"Failed to get response from AI.",message:"Failed to get response from AI."}),await ge.patchMessagesByID(s,r,{message:"Failed to get response from AI.",failed:!0})}}catch(t){f.value=t.message||u("sendMessageFailed")}finally{d("processing-state-change",!1)}}};return(e,t)=>(r(),a("div",je,[f.value?(r(),a("div",Ue,n(f.value),1)):p("",!0),s("div",{class:k(["message-input__box",[y.value.length>20?"w-full":"flex-1"]])},[b(s("textarea",{ref_key:"textareaRef",ref:w,"onUpdate:modelValue":t[0]||(t[0]=e=>y.value=e),placeholder:u("submitPlaceholder"),class:"message-input__textarea",rows:"2","aria-label":"Message Input"},null,8,Ge),[[C,y.value]]),s("div",Ke,n(y.value),1)],2),p("",!0),s("div",{class:k(["message-input__btn",{"ml-auto":y.value.length>20}])},[s("button",{class:"message-input__send",onClick:I,disabled:l.isLoading||!y.value.trim(),title:u("send"),"aria-label":"Send Message"},[l.isLoading?(r(),a("span",We)):(r(),a("span",Ve,[o(He,{width:"20",height:"20"})]))],8,Ye)],2)]))}}),[["__scopeId","data-v-4969118b"]]),ze={class:"wrap"},Je={class:"main-content"},Xe={class:"auth-buttons"},Qe={key:0,class:"auth-buttons__item"},Ze={key:1,class:"auth-buttons__item"},et={class:"welcome-container"},tt={class:"welcome-title"},at={class:"welcome-subtitle"},st={class:"input-container"},nt=W(Object.assign({name:"首頁"},{__name:"MainView",setup(t){const{t:i}=N(),l=e=>i(`auth.${e}`),d=e=>i(`main.${e}`),c=V(),u=B(),g=e(!1),p=e(!1),h=m((()=>{const e=localStorage.getItem("access_token"),t=localStorage.getItem("refresh_token"),a=localStorage.getItem("token_type");return!!(e&&t&&a)})),_=()=>{u.push("/login")},y=()=>{u.push("/register")},w=()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("token_type"),c.clearCurrentChat(),c.chatHistory=[],alert("您已成功登出"),setTimeout((()=>{window.location.reload()}),100)},f=async e=>{try{g.value=!0;const e=c.createNewChat(`對話 ${(new Date).toLocaleString()}`);await u.push(`/chat/${e}`)}catch(t){}finally{g.value=!1}},S=e=>{g.value=e,p.value=e};return(e,t)=>(r(),a("div",ze,[o(Le),s("div",Je,[s("div",Xe,[h.value?(r(),a("div",Ze,[s("button",{class:"auth-btn auth-btn--logout",onClick:w},n(l("logOut")),1)])):(r(),a("div",Qe,[s("button",{class:"auth-btn auth-btn--login",onClick:_},n(l("logIn")),1),s("button",{class:"auth-btn auth-btn--register",onClick:y},n(l("register")),1)]))]),s("div",et,[t[0]||(t[0]=s("div",{class:"welcome-icon"},"👋",-1)),s("h1",tt,n(d("welcome")),1),s("p",at,n(d("welcomeSubtext")),1)]),s("div",st,[o(qe,{onProcessingStateChange:S,onMessageSubmit:f,"is-loading":g.value},null,8,["is-loading"])])])]))}}),[["__scopeId","data-v-843fed0e"]]),ot=O({history:x("./"),routes:[{path:"/",name:"main",component:nt,meta:{title:"Techxim® GPT - 首頁",keepAlive:!0}},{path:"/chat/:id",name:"chat",component:()=>Y((()=>import("./ChatView-C1Z61jci.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]),import.meta.url),meta:{title:"Techxim® GPT - 對話",requiresAuth:!1},beforeEnter:(e,t,a)=>{V().chatHistory.some((t=>t.id==e.params.id))?a():a({name:"main"})}},{path:"/settings",name:"settings",component:()=>Y((()=>import("./SettingsView-Dsq0JfMh.js")),__vite__mapDeps([11,2,5,6,1,8,9,3,4,12]),import.meta.url),meta:{title:"Techxim® GPT - 設置",requiresAuth:!1}},{path:"/register",name:"register",component:()=>Y((()=>import("./RegisterView-Dy0YP5hK.js")),__vite__mapDeps([13,2,1,5,6,8,9,3,4,14]),import.meta.url),meta:{title:"Techxim® GPT - 註冊"}},{path:"/login",name:"login",component:()=>Y((()=>import("./LoginView-DonUAo7e.js")),__vite__mapDeps([15,2,1,5,6,8,9,3,4,16]),import.meta.url),meta:{title:"Techxim® GPT - 登入"}},{path:"/:pathMatch(.*)*",name:"not-found",redirect:{name:"main"}}],scrollBehavior:(e,t,a)=>a||{top:0}});ot.beforeEach(((e,t,a)=>{document.title=e.meta.title||"Techxim® GPT",a()}));const it=$({legacy:!1,locale:"zh_TW",fallbackLocale:"en",messages:{zh_TW:{auth:{logIn:"登入",register:"註冊",term:"特奇新科機股份有限公司®使用者條款",email:"電子郵件",password:"密碼",confirmPassword:"請確認密碼",company:"公司名稱",firstName:"姓名",lastName:"姓氏",cellphone:"電話",goToSignUp:"立即註冊",goToLogin:"馬上登入",logOut:"登出",askIsNew:"還沒有帳號？",askIsMember:"已經有帳號？",askIsReadTerm:"我已詳細閱讀與同意",emailPlaceholder:"請輸入您的電子郵件",passwordPlaceholder:"請輸入密碼",noAccount:"還沒有帳號？",registerSuccess:"註冊成功！即將跳轉到登入頁面...",lastNamePlaceholder:"請輸入您的姓氏",firstNamePlaceholder:"請輸入您的名字",cellphonePlaceholder:"請輸入您的電話號碼",companyPlaceholder:"請輸入您的公司名稱",logOutSuccess:"您已成功登出",notAuthenticated:"請登入以繼續",passwordHint:"密碼長度至少需要 8 碼",message:{noInputWarning:"請檢查電子郵件或密碼是否為空",notAuthenticated:"請登入以繼續",authenticated:"登入成功",validEmail:"電子郵件格式不正確",validPassword:"密碼長度至少需要 8 碼",validConfirmPassword:"密碼和確認密碼不同",validIsReadTerm:"請閱讀並同意特奇新科機®使用者條款",registerFailed:"註冊失敗，請稍後再試"}},main:{generate:"生成",cancel:"取消",confirm:"確認",user:"使用者",assistant:"助理",system:"系統",newChat:"新增對話",setting:"設定",name:"名稱",enterToSubmit:"按 Enter 鍵送出",submitPlaceholder:"輸入訊息…",noSessionIdWarning:"未提供 session_id",default:"預設",loading:"載入中應用...",empty:"尚無對話記錄",emptySubtext:"點擊上方的「新對話」按鈕開始聊天",version:"版本",confirmDelete:"確認刪除",confirmDeleteSubtext:"您確定要刪除這個對話嗎？此操作無法撤銷。",delete:"刪除",send:"送出",greeting:"歡迎使用 AI 助手",greetingSubtext:"我可以為你做什麼？你可以詢問任何問題，我會盡力協助你。",greetingExample1:"解釋量子計算的基本原理",greetingExample2:"幫我寫一個簡單的 Vue 組件",greetingExample3:"如何提高程式碼效能？",save:"保存",newMessages:"↓ 新訊息",error:"載入對話時發生錯誤",error_message:"請返回首頁或嘗試重新載入",back_to_home:"返回首頁",unknowError:"發生未知錯誤…",today:"今天",yesterday:"昨天",last7Days:"過去 7 天",last30Days:"過去 30 天",noChats:"尚無對話記錄",startNewChat:"點擊上方的「新對話」按鈕開始聊天",welcome:"歡迎使用 AI 助手",welcomeSubtext:"開始一個新對話，輸入你的問題，AI 助手將為你提供協助。",defaultDescription:"這是一個用於存儲和檢索文檔的知識庫。",knowledgeBaseName:"知識庫",pleaseInputKnowledgeBaseName:"請輸入知識庫名稱",knowledgeBaseCreatedSuccess:"知識庫創建成功",knowledgeBaseCreatedFailed:"知識庫創建失敗",knowledgeBaseCreatedFailedMessage:"創建知識庫失敗: ",pleaseSelectAtLeastOneFile:"請選擇至少一個文件",uploadingFiles:"開始上傳文件...",uploadingFilesSuccess:"文件上傳完成，正在處理...",uploadingFilesError:"上傳文件時發生錯誤",gettingDocumentsList:"正在獲取文檔列表...",updatingKnowledgeBaseInfo:"正在更新知識庫信息...",knowledgeBaseUpdatedSuccess:"知識庫更新成功",operationFailed:"操作失敗: ",unknownError:"發生未知錯誤",gettingKnowledgeBaseDetails:"正在獲取知識庫資料...",updateModelFailed:"更新模型失敗: ",noDescription:"無描述",knowledgeBaseSetting:"知識庫設定",modelSetting:"模型設定",knowledgeBaseDescription:"描述",modelDescription:"模型描述",knowledgeBaseFile:"知識庫文件",supportFileFormat:"支持 PDF、DOCX、TXT 等格式",chooseFile:"選擇文件",uploadFileSequence:"上傳文件序列",uploadedKnowledgeBaseFile:"已上傳知識庫檔案",uploaded:"已上傳",uploading:"上傳中...",canceling:"取消中...",chooseModel:"選擇模型",currentModel:"當前使用",copied:"已複製!",copyCode:"複製代碼",newChatFailed:"未獲取到新對話 ID",defaultTitle:"預設知識庫名稱",sendMessageFailed:"發送訊息失敗，請稍後再試",modelUpdatedSuccess:"模型更新成功"}},en:{auth:{logIn:"Login In",register:"Sign Up",term:"Techxim® Terms of service",email:"Email",password:"Password",confirmPassword:"Please re-enter your password",company:"Company",firstName:"First Name",lastName:"Last Name",cellphone:"CellPhone",goToSignUp:"Sign up now",goToLogin:"Log in",logOut:"Log Out",askIsNew:"New here?",askIsMember:"Welcome back!",askIsReadTerm:"I have read and agreed with the",emailPlaceholder:"Please enter your email",passwordPlaceholder:"Please enter your password",noAccount:"No account?",registerSuccess:"Register success! Redirecting to login page...",lastNamePlaceholder:"Please enter your last name",firstNamePlaceholder:"Please enter your first name",cellphonePlaceholder:"Please enter your phone number",companyPlaceholder:"Please enter your company name",logOutSuccess:"You have successfully logged out",notAuthenticated:"Please log in to continue",passwordHint:"Password must be at least 8 characters",message:{noInputWarning:"Please check if the email or password is empty.",notAuthenticated:"Please log in to continue",authenticated:"Login success!",validEmail:"Invalid email address",validPassword:"Password must be at least 8 characters",validConfirmPassword:"Password and Confirm Password do not match",validIsReadTerm:"You must agree to the terms and service",registerFailed:"Register failed, please try again later"}},main:{generate:"Generate",cancel:"Cancel",confirm:"Confirm",user:"User",assistant:"Assistant",system:"System",newChat:"New Chat",setting:"Settings",name:"Name",enterToSubmit:"Enter to submit",submitPlaceholder:"Type a message...",noSessionIdWarning:"No session_id",default:"Default",loading:"Loading application...",empty:"No chat history",emptySubtext:'Click the "New Chat" button above to start chatting',version:"Version",confirmDelete:"Confirm Delete",confirmDeleteSubtext:"Are you sure you want to delete this chat? This action cannot be undone.",delete:"Delete",send:"Send",greeting:"Welcome to AI Assistant",greetingSubtext:"What can I do for you? You can ask any question, and I will do my best to help you.",greetingExample1:"Explain the basic principles of quantum computing",greetingExample2:"Write a simple Vue component for me",greetingExample3:"How to improve code performance?",save:"Save",newMessages:"↓ New Messages",error:"Error loading chat",error_message:"Please return to the home page or try reloading",back_to_home:"Back to Home",unknowError:"Unknown error",today:"Today",yesterday:"Yesterday",last7Days:"Last 7 Days",last30Days:"Last 30 Days",noChats:"No Chat History",startNewChat:'Click the "New Chat" button above to start chatting',welcome:"Welcome to AI Assistant",welcomeSubtext:"Start a new chat, input your question, and the AI assistant will help you.",defaultDescription:"This is a knowledge base for storing and retrieving documents.",knowledgeBaseName:"Knowledge Base",pleaseInputKnowledgeBaseName:"Please input the knowledge base name",knowledgeBaseCreatedSuccess:"Knowledge base created successfully",knowledgeBaseCreatedFailed:"Knowledge base creation failed",knowledgeBaseCreatedFailedMessage:"Knowledge base creation failed: ",pleaseSelectAtLeastOneFile:"Please select at least one file",uploadingFiles:"Starting to upload files...",uploadingFilesSuccess:"Files uploaded successfully, processing...",uploadingFilesError:"Error uploading files",gettingDocumentsList:"Getting documents list...",updatingKnowledgeBaseInfo:"Updating knowledge base info...",knowledgeBaseUpdatedSuccess:"Knowledge base updated successfully",operationFailed:"Operation failed: ",unknownError:"Unknown error",gettingKnowledgeBaseDetails:"Getting knowledge base details...",updateModelFailed:"Update model failed: ",noDescription:"No description",knowledgeBaseSetting:"Knowledge Base Setting",modelSetting:"Model Setting",knowledgeBaseDescription:"Description",modelDescription:"Model Description",knowledgeBaseFile:"Knowledge Base File",supportFileFormat:"Support PDF, DOCX, TXT, etc.",chooseFile:"Choose File",uploadFileSequence:"Upload File Sequence",uploadedKnowledgeBaseFile:"Uploaded Knowledge Base File",uploaded:"Uploaded",uploading:"Uploading...",canceling:"Canceling...",chooseModel:"Choose Model",currentModel:"Current Model",copied:"Copied!",copyCode:"Copy Code",newChatFailed:"No new chat ID",defaultTitle:"Default Title",sendMessageFailed:"Send message failed, please try again later",modelUpdatedSuccess:"Model updated successfully"}}}});F.Random.extend({aiModel:function(){return this.pick(["gpt-3.5-turbo","gpt-4","gpt-4-turbo","claude-2","claude-instant","llama-2"])},techTopic:function(){return this.pick(["前端開發","後端開發","機器學習","區塊鏈","雲計算","網絡安全","數據分析","人工智能","DevOps","移動開發"])},programmingLanguage:function(){return this.pick(["JavaScript","Python","Java","C++","Go","Rust","PHP","Ruby","Swift","Kotlin"])},knowledgeBaseName:function(){return`${this.pick(["技術文檔","API文檔","使用手冊","開發指南","最佳實踐","學習資源"])}-${this.pick(["前端","後端","DevOps","AI","數據庫","安全"])}`}});we()&&(F.mock(new RegExp(le.SESSIONS),"get",(()=>{const e=F.Random.integer(3,10),t=[];for(let a=0;a<e;a++)t.push({id:F.Random.guid(),title:F.Random.ctitle(3,8),description:F.Random.csentence(10,20),created_at:F.Random.datetime(),updated_at:F.Random.datetime(),user_id:F.Random.guid(),knowledge_base_id:F.Random.boolean()?F.Random.guid():null,llm_id:F.Random.guid()});return t})),F.mock(new RegExp(le.SESSION_BY_ID(".*")),"get",(()=>({id:F.Random.guid(),title:F.Random.ctitle(3,8),description:F.Random.csentence(10,20),created_at:F.Random.datetime(),updated_at:F.Random.datetime(),user_id:F.Random.guid(),knowledge_base_id:F.Random.boolean()?F.Random.guid():null,llm_id:F.Random.guid()}))),F.mock(new RegExp(le.MESSAGES(".*")),"get",(()=>{const e=F.Random.integer(5,15),t=[];for(let a=0;a<e;a++)t.push({id:F.Random.guid(),role:F.Random.boolean()?"user":"assistant",message:F.Random.cparagraph(2,5),created_at:F.Random.datetime(),updated_at:F.Random.datetime(),session_id:F.Random.guid(),user_id:F.Random.guid()});return t})),F.mock(new RegExp(re.BASE),"get",(()=>{const e=F.Random.integer(3,8),t=[];for(let a=0;a<e;a++)t.push({id:F.Random.guid(),name:F.Random.knowledgeBaseName(),description:F.Random.csentence(10,20),created_at:F.Random.datetime(),updated_at:F.Random.datetime(),user_id:F.Random.guid(),document_count:F.Random.integer(0,100),total_tokens:F.Random.integer(1e3,1e6)});return t})),F.mock(new RegExp(de.MODELS),"get",(()=>{const e=F.Random.integer(4,8),t=[];for(let a=0;a<e;a++)t.push({id:F.Random.guid(),name:F.Random.aiModel(),description:F.Random.csentence(10,20),type:F.Random.pick(["chat","completion","embedding"]),created_at:F.Random.datetime(),updated_at:F.Random.datetime(),is_active:F.Random.boolean(),config:{temperature:F.Random.float(0,1),max_tokens:F.Random.integer(100,4e3),top_p:F.Random.float(0,1),frequency_penalty:F.Random.float(0,2),presence_penalty:F.Random.float(0,2)}});return t})));const lt=D(G);lt.config.errorHandler=(e,t,a)=>{},lt.config.globalProperties.$appName="Techxim® GPT",lt.config.globalProperties.$appVersion="1.0.0";const rt=P();rt.use(A),lt.use(rt),lt.use(ot),lt.use(it),lt.mount("#app");export{se as C,J as I,qe as M,Le as S,W as _,me as a,ge as c,we as g,he as k,pe as s,ye as t,V as u};
