<!DOCTYPE html>
<html lang="zh-Hant-TW">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
		<script src="https://tw.hicdn.beanfun.com/plugins/isMobile/isMobile.min.js"></script>
	</head>
	<body>
		<a href="#" data-link="https://tw.hicdn.beanfun.com/beanfun/WebImage/20230706044949.png" onclick="downloadImage1(); return false;" class="wallpaper-link">下載1</a>
		<a href="#" data-link="https://tw.hicdn.beanfun.com/beanfun/WebImage/20230706044949.png" onclick="downloadImage2(); return false;" class="wallpaper-link">下載2</a>
		<a href="#" data-link="https://tw.hicdn.beanfun.com/beanfun/WebImage/20230706044949.png" onclick="downloadImage3(); return false;" class="wallpaper-link wallpaper-link3">下載3</a>
		<script>
			// 檢測是否為Android設備
			function isAndroid() {
				return /Android/i.test(navigator.userAgent);
			}
			function downloadForMobile(url) {
				// 為移動設備創建一個新的窗口來打開圖片
				window.open(url, "_blank");
			}
			// 桌面設備的下載處理
			function downloadForDesktop(url) {
				fetch(url)
					.then((response) => response.blob())
					.then((blob) => {
						const blobUrl = window.URL.createObjectURL(blob);
						const a = document.createElement("a");
						a.style.display = "none";
						a.href = blobUrl;
						a.download = "壁紙";
						document.body.appendChild(a);
						a.click();
						window.URL.revokeObjectURL(blobUrl);
						document.body.removeChild(a);
					})
					.catch((error) => console.error("下载出错:", error));
			}

			function downloadImage1() {
				let url = document.querySelector(".wallpaper-link").getAttribute("data-link");
				fetch(url)
					.then((response) => response.blob())
					.then((blob) => {
						const blobUrl = window.URL.createObjectURL(blob);
						const a = document.createElement("a");
						a.style.display = "none";
						a.href = blobUrl;
						a.download = "壁紙";
						document.body.appendChild(a);
						a.click();
						window.URL.revokeObjectURL(blobUrl);
						document.body.removeChild(a);
					})
					.catch((error) => console.error("下载出错:", error));
			}

			function downloadImage2() {
				let url = document.querySelector(".wallpaper-link").getAttribute("data-link");
				if (isAndroid()) {
					downloadForMobile(url);
				} else {
					downloadForDesktop(url);
				}
			}

			// document.addEventListener("DOMContentLoaded", function () {
			// 	if (isMobile.any) {
			// 		// .wallpaper-link3 增加download屬性
			// 		document.querySelector(".wallpaper-link3").setAttribute("download", "壁紙");
			// 		// 把 data-link 值放到href
			// 		document.querySelector(".wallpaper-link3").setAttribute("href", document.querySelector(".wallpaper-link3").getAttribute("data-link"));
			// 		// 並加上target _blank
			// 		document.querySelector(".wallpaper-link3").setAttribute("target", "_blank");
			// 	}
			// });
			function downloadImage3() {
				let url = document.querySelector(".wallpaper-link").getAttribute("data-link");
				if (!isMobile.any) {
					downloadForDesktop(url);
				} else {
					downloadForMobile(url);
				}
			}
		</script>
	</body>
</html>
