<!DOCTYPE html>
<html lang="zh-Hant-TW">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
		<link rel="manifest" href="./manifest.json" />
	</head>
	<body>
		An image will appear here in 3 seconds:
		<script>
			navigator.serviceWorker
				.register("./sw.js")
				.then((reg) => console.log("SW registered!", reg))
				.catch((err) => console.log("Boo!", err));

			setTimeout(() => {
				const img = new Image();
				img.src = "https://images.dog.ceo/breeds/finnish-lapphund/mochilamvan.jpg";
				document.body.appendChild(img);
			}, 3000);
			function askForNotificationPermission() {
				Notification.requestPermission(function (result) {
					// 這裡result只會有兩種結果：一個是用戶允許(granted)，另一個是用戶封鎖(denied)
					console.log("User Choice", result);
					if (result !== "granted") {
						console.log("No notification permission granted!");
					} else {
						displayConfirmNotification();
					}
				});
			}

			if ("Notification" in window) {
				askForNotificationPermission();
			}
			function displayConfirmNotification() {
				if ("serviceWorker" in navigator) {
					var options = {
						body: "您已成功訂閱我們的推播服務!",
						icon: "/src/images/icons/app-icon-96x96.png",
						image: "/src/images/sf-boat.jpg",
						dir: "ltr",
						lang: "zh-TW", // BCP 47
						vibrate: [100, 50, 200],
						badge: "/src/images/icons/app-icon-96x96.png",
						tag: "confirm-notification",
						renotify: true,
						actions: [
							{ action: "confirm", title: "收到", icon: "/src/images/icons/app-icon-96x96.png" },
							{ action: "cancel", title: "取消", icon: "/src/images/icons/app-icon-96x96.png" }
						]
					};
					navigator.serviceWorker.ready.then(function (swreg) {
						swreg.showNotification("成功訂閱!! (from Service Worker)", options);
					});
				}
			}
			function configurePushSub() {
				if (!("serviceWorker" in navigator)) {
					return;
				}
				var reg;
				navigator.serviceWorker.ready
					.then(function (swreg) {
						reg = swreg;
						return swreg.pushManager.getSubscription();
					})
					.then(function (sub) {
						if (sub === null) {
							// Create a new subscription
							reg.pushManager.subscribe({
								userVisibleOnly: true
							});
						} else {
							// We have a subscription
						}
					});
			}
		</script>
	</body>
</html>
